---
title: "Project 2"
author: "Anna Su, Donovan Calvert, Naren Makkapati"
resource_files:
- .Renviron
output:
  html_notebook:
    code_folding: hide
    toc: yes
    toc_depth: 4
    toc_float: yes
runtime: shiny
---
This is an R Interactive Document, which uses the [R Markdown](http://rmarkdown.rstudio.com/authoring_basics.html) language to generate HTML. For a brief introduction to R Markdown, please review this [video](https://www.youtube.com/watch?v=DNS7i2m4sB0&feature=youtu.be).

#Load Packages
This [code chunk](http://rmarkdown.rstudio.com/authoring_rcodechunks.html) loads the packages required to run the R code in the document.
The last line of this code chunk enables document caching, which is expalined at this [link](http://rmarkdown.rstudio.com/authoring_rcodechunks.html).

```{r setup, echo=FALSE}
library(tidyverse)
library(shiny)
library(grid)
library(data.world)
library(DT)
library(shinydashboard)
library(plotly)
library(lubridate)
knitr::opts_chunk$set(echo = TRUE)
```

#Display Session Information
The [sessionInfo() fuction](https://cran.r-project.org/web/packages/sessioninfo/sessioninfo.pdf) queries and prints information about the current R session including  information about packages, and from where they were installed.
```{r}
sessionInfo()
```

#Section for Links

Data.world Project link: https://data.world/yuchan-su/s18-edv-project-2

GitHub Classroom Repository link: https://github.com/CannataUTDV/s18dvproject1-su-makkapati-calvert


#Create Dataframes
The sourced code below contains Shiny [eventReactive](https://shiny.rstudio.com/reference/shiny/1.0.1/observeEvent.html) code and queries for the SuperStore database at data.world. The data is saved in variables as functions that return an R dataframe. These are examples data.world parameterized queries; details for data.world queries can be found at this [link](https://cran.r-project.org/web/packages/data.world/vignettes/query.html). The "?"s in the query are parameters. The parameters are filled in (in order) by the paramQuery$params statement.

```{r}
source("DataA.R", local = TRUE)
source("DataB.R", local = TRUE)
```

#Retrieve Departments from the IBM Attrition dataset
The following query retrieves the distinct department names from the SIBM Attrition dataset at data.world and saves the department names in the departments variable.
```{r}
project <- "https://data.world/yuchan-su/s18-edv-project-2" 
data.world::set_config(cfg_env("DW_API")) 

#query that selects region
departments <- data.world::query(data.world::qry_sql(
 "   
	select distinct department
  from ibm_hr_attrition
 "), 
dataset = project)
```
#Create a Deparment Variable
Create a Departments variable with a string constructed from the selected departments in the input$selectDepartment_1 variable.This Departments variable will be used in the title of the ggplot below.

```{r}
Departments <- eventReactive(c(input$selectDepartment_1), { 
  library('stringr')
  str_c(input$selectDepartment_1, collapse=', ')
})
```

#Create Panel with Select List
The following code creates an input panel for the Interactive Document, which has a [select box](https://shiny.rstudio.com/reference/shiny/latest/selectInput.html) for selecting departments (notice - choices is set to the departments variable that was loaded by the previous query) For a complete list of Shiny functions, please see this [link](https://shiny.rstudio.com/reference/shiny/latest/).

```{r}
inputPanel(
  selectInput("selectDepartment_1", label = "Select Department",choices = departments, multiple=TRUE, selected=c("Sales","Human Resources","Research & Development"))
)
```

#Render and Display the Shipping Costs Histograms

Using [ggplotly](https://www.rdocumentation.org/packages/plotly/versions/4.7.1/topics/ggplotly) and [shinydashborad](https://rstudio.github.io/shinydashboard/structure.html#dynamic-content-1)

```{r}
dashboardPage(
  dashboardHeader(
  ),
  dashboardSidebar(
    sidebarMenu(
      menuItem("Monthly Income Histogram", tabName = "histogram", icon = icon("dashboard")),
      menuItem("Monthly Income Density Plot", tabName = "density", icon = icon("dashboard")),
      menuItem("Job Satisfaction", tabName = "both", icon = icon("dashboard")),
      menuItem("Department Age", tabName = "newplot", icon = icon("dashboard")),
      menuItem("New Boxplot", tabName = "boxplot", icon = icon("dashboard"))
    )
  ),
  dashboardBody(
    tabItems(
      # 1. "Monthly Incomes Histogram" tab content
      tabItem(tabName = "histogram",
        p("This plot shows the histogram of the monthly income of different departments"),
        source("Histogram1UI.R",local = TRUE)$value
      ),
      # 2. "Monthly Incomes Density Plot" tab content
      tabItem(tabName = "density",
        source("Density1UI.R",local = TRUE)$value
      ),
      # 3. "Shipping Costs Histogram and Density Plot" tab content
      tabItem(tabName = "both",
        p("And even here."),
        source("Both1UI.R",local = TRUE)$value
      ),
      # 4. "Sales Histogram" tab content
      tabItem(tabName = "newplot",
        p("And even here."),
        source("NewPlot1UI.R",local = TRUE)$value
      ),
      # 5. "Monthly Incomes Histogram" tab content
      tabItem(tabName = "boxplot",
        p("This plot shows the histogram of the monthly income of different departments"),
        source("Boxplot1UI.R",local = TRUE)$value
      )
      )
    )
  )
source("Histogram1Server.R", local = TRUE)
source("Density1Server.R", local = TRUE)
source("Both1Server.R", local = TRUE)
source("NewPlot1Server.R", local = TRUE)
source("Boxplot1Server.R", local = TRUE)
```

#Appendix

Displays the code we used to clean up our data. Some code are commented out # (for example the loading/creating new csv file) since they are not needed right now in the interactive application code. However, be aware that it's still part of the process.
```{r}

library(tidyverse)
csvURL <- "https://query.data.world/s/-5chQ_I_MEpn_Pp7NCDce901hNnrs6"

#the lines here would have to change to match the columns in YOUR csv!; you're just telling them if it's string or numbers; SO you are letting them know that sales and profit is actually NUMBERS, since they had the ',' in there before to make it not all integers 

df <- read_csv(csvURL, col_types = list(
  age = col_number(),
  attrition = col_character(),
  businesstravel = col_character(),
  dailyrate= col_number(),
  department = col_character(),
  distancefromhome= col_number(),
  education = col_number(),
  educationfield = col_character(),
  employeecount = col_character(),
  employeenumber = col_number(),
  environmentsatisfaction = col_number(),
  gender = col_character(),
  hourlyrate = col_number(),
  jobinvolvement = col_number(),
  joblevel = col_number(),
  job_role = col_character(),
  jobsatisfaction = col_number(),
  maritalstatus = col_character(),
  monthlyincome = col_number(),
  monthlyrate = col_number(),
  numcompaniesworked = col_number(),
  over18 = col_character(),
  overtime = col_character(),
  percentsalaryhike = col_number(),
  performancerating = col_number(),
  relationshipsatisfaction = col_number(),
  standardhours = col_number(),
  stockoptionlevel = col_number(),
  totalworkingyears = col_number(),
  trainingtimeslastyear = col_number(),
  worklifebalance = col_number(),
  yearsatcompany = col_number(),
  yearsincurrentrole = col_number(),
  yearssincelastpromotion = col_number(),
  yearswithcurrmanager = col_number()
))

# Change .+ and -+ in column names to _
#find any dot (.) and change it to _
names(df) <- gsub("\\.+", " ", names(df))

# Change .+, -+,=,&,+ in column names to "" blank
#find any dot (.) and change it to _
names(df) <- gsub("\\/", " ", names(df))
names(df) <- gsub("\\=", " ", names(df))
names(df) <- gsub("\\&", " ", names(df))
names(df) <- gsub("\\+", " ", names(df))

#find any (-) in the column name and change to _
names(df) <- gsub("-+", " ", names(df))

# Remove non-printable characters from column names.
names(df) <- gsub("[^ -~]", "", names(df)) 

# Change null values in the region_sales and region_profit columns to 0.
#df <- df %>% tidyr::replace_na(list(Age=0, DistanceFromHome =0, EmployeeCount =0, EmployeeNumber = 0, EnvironmentSatisfaction =0, JobInvolvement = 0, JobSatisfaction = 0, NumCompaniesWorked = 0, PerformanceRating = 0, RelationshipSatisfaction = 0, StockOptionLevel = 0, TotalWorkingYears = 0, TrainingTimesLastYear = 0, WorkLifeBalance = 0, YearsAtCompany = 0, YearsInCurrentRole = 0, YearsSinceLastPromotion = 0, YearsWithCurrManager = 0 ))

# Remove non-printable characters from all column values.
df <- df %>% dplyr::mutate_all(funs(gsub(pattern="[^ -~]", replacement= "", .)))
#^ the "." at the end refers to what was pipe in, which is refering to the "df" 

# The following write_csv followed immediately by a read_csv, fixes the column types.
#write_csv(df, "//Users/annasu/Desktop/Spring 2018 Class/CS 329 Data Visualization/Project2/S18 eDV Project 1 Dataset.csv") # /Users/pcannata/Downloads needs to be changed to a known folder on your machine.

# df <- read_csv("/Users/annasu/Desktop/Spring 2018 Class/CS 329 Data Visualization/Project2/S18 eDV Project 1 Dataset.csv", col_types = list(
#   age = col_number(),
#   attrition = col_character(),
#   businesstravel = col_character(),
#   dailyrate= col_number(),
#   department = col_character(),
#   distancefromhome= col_number(),
#   education = col_number(),
#   educationfield = col_character(),
#   employeecount = col_character(),
#   employeenumber = col_number(),
#   environmentalsatisfaction = col_number(),
#   gender = col_character(),
#   hourlyrate = col_number(),
#   jobinvolvement = col_number(),
#   joblevel = col_number(),
#   job_role = col_character(),
#   jobsatisfaction = col_number(),
#   maritalstatus = col_character(),
#   monthlyincome = col_number(),
#   monthlyrate = col_number(),
#   numcompaniesworked = col_number(),
#   over18 = col_character(),
#   overtime = col_character(),
#   percentsalaryhike = col_number(),
#   performancerating = col_number(),
#   relationshipsatisfaction = col_number(),
#   standardhours = col_number(),
#   stockoptionlevel = col_number(),
#   totalworkingyears = col_number(),
#   trainingtimeslastyear = col_number(),
#   worklifebalance = col_number(),
#   yearsatcompany = col_number(),
#   yearsincurrentrole = col_number(),
#   yearssincelastpromotion = col_number(),
#   yearswithcurrentmanager = col_number()
# ))
# Now save the cleaned data to new.csv
#write_csv(df, "/Users/annasu/Desktop/Spring 2018 Class/CS 329 Data Visualization/Project2/newS18 eDV Project 1 Dataset.csv")
# Now load /tmp/new.csv into a data.world Dataset.
#df

```


